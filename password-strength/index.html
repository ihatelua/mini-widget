<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Password Strength Checker | Mini Widget</title>
  <meta name="description" content="강도 점수, 패턴 분석, 이펙트를 결합한 파워형 패스워드 강도 체커" />

  <link rel="icon" type="image/png" href="../favicon/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href="../favicon/favicon.svg" />
  <link rel="shortcut icon" type="image/x-icon" href="../favicon/favicon.ico?" />
  <link rel="apple-touch-icon" sizes="180x180" href="../favicon/apple-touch-icon.png" />
  <link rel="manifest" href="../favicon/site.webmanifest" />

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet" />

  <style>
    :root {
      --bg: #f6f9ff;
      --bg-2: #edf3ff;
      --ink: #0f172a;
      --ink-dim: #4c5b76;
      --line: rgba(20, 39, 74, 0.14);
      --card: rgba(255, 255, 255, 0.8);
      --shadow: 0 26px 64px rgba(24, 48, 91, 0.16);
      --weak: #eb3b5a;
      --mid: #f59e0b;
      --good: #2b8cff;
      --strong: #0f9f6d;
      --xstrong: #7c3aed;
    }

    * { box-sizing: border-box; }
    html, body { margin: 0; min-height: 100%; }

    body {
      font-family: "Space Grotesk", "Noto Sans KR", sans-serif;
      color: var(--ink);
      background:
        radial-gradient(circle at 8% 10%, rgba(43, 140, 255, 0.18), transparent 35%),
        radial-gradient(circle at 90% 8%, rgba(124, 58, 237, 0.16), transparent 28%),
        radial-gradient(circle at 50% 100%, rgba(15, 159, 109, 0.14), transparent 32%),
        linear-gradient(150deg, var(--bg), var(--bg-2));
      overflow-x: hidden;
    }

    .shell {
      width: min(1160px, calc(100% - 2rem));
      margin: clamp(18px, 4vw, 48px) auto;
      position: relative;
      z-index: 2;
    }

    .top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 14px;
      gap: 10px;
    }

    .brand {
      margin: 0;
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--ink-dim);
      font-weight: 700;
    }

    .back-link {
      color: var(--ink);
      text-decoration: none;
      font-size: 0.85rem;
      border: 1px solid var(--line);
      background: rgba(255, 255, 255, 0.64);
      border-radius: 999px;
      padding: 8px 12px;
    }

    .card {
      border: 1px solid var(--line);
      border-radius: 22px;
      background: var(--card);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      padding: clamp(14px, 2.5vw, 28px);
      position: relative;
      transform-origin: center;
    }

    .card.power {
      box-shadow:
        0 26px 64px rgba(24, 48, 91, 0.16),
        0 0 0 2px rgba(124, 58, 237, 0.16),
        0 0 60px rgba(43, 140, 255, 0.15);
    }

    h1 { margin: 0; font-size: clamp(1.8rem, 4vw, 2.6rem); }
    .desc { margin: 8px 0 8px; color: var(--ink-dim); }
    .notice {
      margin: 0 0 16px;
      font-size: 0.9rem;
      color: #475569;
      background: rgba(255, 255, 255, 0.74);
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 9px 12px;
    }

    .grid {
      display: grid;
      grid-template-columns: 1.04fr 0.96fr;
      gap: 12px;
    }

    .panel {
      border: 1px solid var(--line);
      border-radius: 14px;
      background: rgba(255, 255, 255, 0.84);
      padding: 14px;
    }

    .field-label {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--ink-dim);
      font-weight: 700;
      margin-bottom: 8px;
      display: block;
    }

    .password-wrap {
      display: flex;
      gap: 8px;
      position: relative;
    }

    input[type="password"],
    input[type="text"] {
      flex: 1;
      width: 100%;
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 12px;
      font: inherit;
      font-size: 1rem;
      color: var(--ink);
      background: rgba(255, 255, 255, 0.94);
      outline: none;
      transition: box-shadow 140ms ease, border-color 140ms ease;
    }

    input.powering {
      border-color: rgba(43, 140, 255, 0.5);
      box-shadow: 0 0 0 4px rgba(43, 140, 255, 0.14);
    }

    button {
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 0 12px;
      background: #fff;
      font: inherit;
      cursor: pointer;
      font-weight: 600;
    }

    .meter {
      height: 14px;
      border-radius: 999px;
      background: #e4eaf7;
      overflow: hidden;
      margin-top: 14px;
      border: 1px solid #d7dff0;
      position: relative;
    }

    .meter__bar {
      height: 100%;
      width: 0%;
      transition: width 180ms ease, background-color 180ms ease;
      background: var(--weak);
      position: relative;
    }

    .meter__bar::after {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.7), transparent);
      transform: translateX(-100%);
      animation: shine 1.4s linear infinite;
    }

    @keyframes shine {
      to { transform: translateX(100%); }
    }

    .score-line {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-top: 10px;
      gap: 12px;
    }

    .score {
      font-size: 1.55rem;
      font-weight: 700;
      letter-spacing: -0.01em;
    }

    .level {
      font-size: 0.98rem;
      font-weight: 700;
    }

    .meta {
      margin-top: 14px;
      display: grid;
      gap: 8px;
      color: var(--ink-dim);
      font-size: 0.92rem;
    }

    .tips {
      margin-top: 12px;
      border: 1px dashed #c6d4f3;
      border-radius: 10px;
      padding: 10px;
      color: #334155;
      font-size: 0.9rem;
      min-height: 44px;
      background: rgba(244, 248, 255, 0.8);
    }

    .checklist {
      margin: 0;
      padding-left: 0;
      list-style: none;
      display: grid;
      gap: 7px;
      font-size: 0.92rem;
      color: #25324b;
      max-height: 420px;
      overflow: auto;
    }

    .checklist li {
      border: 1px solid #d8e2f7;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.9);
      padding: 8px 10px;
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 600;
    }

    .checklist li .mark {
      width: 18px;
      height: 18px;
      border-radius: 999px;
      border: 1px solid #cbd5e1;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      flex: none;
      background: #fff;
      color: #64748b;
    }

    .checklist li.ok {
      border-color: rgba(15, 159, 109, 0.35);
      background: rgba(236, 253, 245, 0.9);
      color: #065f46;
    }

    .checklist li.ok .mark {
      background: #0f9f6d;
      color: #fff;
      border-color: #0f9f6d;
    }

    .checklist li.warn {
      color: #92400e;
      background: rgba(255, 251, 235, 0.92);
      border-color: rgba(180, 83, 9, 0.3);
    }

    #fxLayer {
      position: fixed;
      inset: 0;
      width: 100vw;
      height: 100vh;
      pointer-events: none;
      z-index: 1;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      margin-top: 10px;
      font-size: 0.78rem;
      border: 1px solid #d1dcf4;
      border-radius: 999px;
      padding: 6px 10px;
      background: rgba(255,255,255,0.86);
      color: #334155;
      font-weight: 700;
      letter-spacing: 0.04em;
      text-transform: uppercase;
    }

    @media (max-width: 880px) {
      .grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <canvas id="fxLayer" aria-hidden="true"></canvas>

  <main class="shell">
    <div class="top">
      <p class="brand">홈 / 패스워드 분석기</p>
      <a class="back-link" href="../index.html">뒤로가기</a>
    </div>

    <section class="card" id="mainCard">
      <h1>패스워드 분석기</h1>
      <p class="desc">입력할수록 파워 이펙트가 반응하는 인터랙티브 강도 분석기.</p>
      <p class="notice">안내: "절대" 안전한 비밀번호는 없습니다. 이 도구는 뚫기 매우 어렵게 만드는 데 초점을 둡니다.</p>

      <div class="grid">
        <div class="panel">
          <label class="field-label" for="passwordInput">패스워드</label>
          <div class="password-wrap">
            <input id="passwordInput" type="password" placeholder="강한 비밀번호를 입력하세요" autocomplete="off" />
            <button id="btnToggle" type="button">보기</button>
          </div>

          <div class="meter" aria-hidden="true">
            <div id="meterBar" class="meter__bar"></div>
          </div>

          <div class="score-line">
            <div id="scoreText" class="score">0 / 100</div>
            <div id="levelText" class="level">Very Weak</div>
          </div>

          <div class="badge" id="comboBadge">Security Combo x0</div>

          <div class="meta" id="metaInfo">
            <div>길이: 0자</div>
            <div>엔트로피: - bit</div>
            <div>예상 조합 수: -</div>
            <div>온라인 공격 추정(10/s): -</div>
            <div>오프라인 공격 추정(10^10/s): -</div>
          </div>

          <div class="tips" id="tips">더 강하게 만들려면 길이를 늘리고 예측 가능한 패턴을 피하세요.</div>
        </div>

        <div class="panel">
          <label class="field-label">Advanced Checklist</label>
          <ul class="checklist" id="checklist"></ul>
        </div>
      </div>
    </section>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/zxcvbn@4.4.2/dist/zxcvbn.js"></script>
  <script>
    (function () {
      const input = document.getElementById("passwordInput");
      const btnToggle = document.getElementById("btnToggle");
      const meterBar = document.getElementById("meterBar");
      const scoreText = document.getElementById("scoreText");
      const levelText = document.getElementById("levelText");
      const metaInfo = document.getElementById("metaInfo");
      const checklistEl = document.getElementById("checklist");
      const tips = document.getElementById("tips");
      const mainCard = document.getElementById("mainCard");
      const comboBadge = document.getElementById("comboBadge");
      const fxLayer = document.getElementById("fxLayer");

      function syncFxCanvasSize() {
        const ratio = Math.max(1, Math.min(window.devicePixelRatio || 1, 2));
        const w = Math.floor(window.innerWidth * ratio);
        const h = Math.floor(window.innerHeight * ratio);
        if (fxLayer.width !== w || fxLayer.height !== h) {
          fxLayer.width = w;
          fxLayer.height = h;
        }
      }

      syncFxCanvasSize();
      window.addEventListener("resize", syncFxCanvasSize);

      const confettiFx = confetti.create(fxLayer, { resize: true, useWorker: true });

      let prevScore = 0;
      let prevLevelRank = 0;
      let combo = 0;

      const commonWeakSet = new Set([
        "password", "password123", "qwerty", "qwerty123", "admin", "admin123",
        "letmein", "welcome", "iloveyou", "123456", "12345678", "asdf1234"
      ]);

      const ruleSpecs = [
        { id: "len12", label: "12자 이상", weight: 10, test: (p) => p.length >= 12 },
        { id: "len16", label: "16자 이상", weight: 8, test: (p) => p.length >= 16 },
        { id: "len20", label: "20자 이상 (권장)", weight: 6, test: (p) => p.length >= 20 },
        { id: "lower", label: "소문자 포함", weight: 7, test: (p) => /[a-z]/.test(p) },
        { id: "upper", label: "대문자 포함", weight: 7, test: (p) => /[A-Z]/.test(p) },
        { id: "number", label: "숫자 포함", weight: 7, test: (p) => /[0-9]/.test(p) },
        { id: "symbol", label: "특수문자 포함", weight: 8, test: (p) => /[^A-Za-z0-9\s]/.test(p) },
        { id: "noSpace", label: "공백 미사용", weight: 4, test: (p) => !/\s/.test(p) },
        { id: "noRepeat3", label: "같은 문자 3회 이상 연속 없음", weight: 8, test: (p) => !/(.)\1\1/.test(p) },
        { id: "noSeq", label: "연속 패턴(abc/123 등) 없음", weight: 8, test: (p) => !hasSimpleSequence(p) },
        { id: "noKeyboard", label: "키보드 패턴(qwer/asdf 등) 없음", weight: 6, test: (p) => !hasKeyboardPattern(p) },
        { id: "noYear", label: "연도 패턴(19xx/20xx) 미포함", weight: 4, test: (p) => !/(19\d{2}|20\d{2})/.test(p) },
        { id: "charVariety", label: "서로 다른 문자 비율 60% 이상", weight: 7, test: (p) => uniqueRatio(p) >= 0.6 },
        { id: "notCommon", label: "흔한 비밀번호 목록 미포함", weight: 10, test: (p) => !containsCommonToken(p) },
        { id: "entropy", label: "엔트로피 70bit 이상", weight: 10, test: (p) => entropyBits(p) >= 70 }
      ];

      function hasSimpleSequence(pw) {
        const s = pw.toLowerCase();
        for (let i = 0; i < s.length - 2; i += 1) {
          const a = s.charCodeAt(i);
          const b = s.charCodeAt(i + 1);
          const c = s.charCodeAt(i + 2);
          if ((b === a + 1 && c === b + 1) || (b === a - 1 && c === b - 1)) {
            return true;
          }
        }
        return false;
      }

      function hasKeyboardPattern(pw) {
        const s = pw.toLowerCase();
        const rows = ["qwertyuiop", "asdfghjkl", "zxcvbnm", "1234567890"];
        for (const row of rows) {
          for (let i = 0; i < row.length - 2; i += 1) {
            const part = row.slice(i, i + 3);
            const rev = part.split("").reverse().join("");
            if (s.includes(part) || s.includes(rev)) return true;
          }
        }
        return false;
      }

      function uniqueRatio(pw) {
        if (!pw.length) return 0;
        return new Set(pw).size / pw.length;
      }

      function charsetSize(pw) {
        let size = 0;
        if (/[a-z]/.test(pw)) size += 26;
        if (/[A-Z]/.test(pw)) size += 26;
        if (/[0-9]/.test(pw)) size += 10;
        if (/[^A-Za-z0-9\s]/.test(pw)) size += 33;
        if (/\s/.test(pw)) size += 1;
        return size;
      }

      function entropyBits(pw) {
        const cs = charsetSize(pw);
        if (!pw.length || !cs) return 0;
        return pw.length * Math.log2(cs);
      }

      function containsCommonToken(pw) {
        const low = pw.toLowerCase();
        if (commonWeakSet.has(low)) return true;
        for (const token of commonWeakSet) {
          if (token.length >= 6 && low.includes(token)) return true;
        }
        return false;
      }

      function safeBigIntPow(base, exp) {
        if (exp <= 0 || base <= 0) return 0n;
        return BigInt(base) ** BigInt(exp);
      }

      function formatBigInt(n) {
        if (n <= 0n) return "-";
        const str = n.toString();
        if (str.length <= 6) return str;
        return `${str.slice(0, 3)}e+${str.length - 1}`;
      }

      function humanSeconds(seconds) {
        if (seconds <= 0n) return "즉시";
        const minute = 60n;
        const hour = 3600n;
        const day = 86400n;
        const year = 31536000n;
        if (seconds < minute) return `${seconds}초`;
        if (seconds < hour) return `${seconds / minute}분`;
        if (seconds < day) return `${seconds / hour}시간`;
        if (seconds < year) return `${seconds / day}일`;
        if (seconds < year * 1000n) return `${seconds / year}년`;
        return `${seconds / year}년+`;
      }

      function getLevel(score) {
        if (score < 30) return { text: "Very Weak", color: "var(--weak)", rank: 0 };
        if (score < 50) return { text: "Weak", color: "var(--weak)", rank: 1 };
        if (score < 70) return { text: "Medium", color: "var(--mid)", rank: 2 };
        if (score < 86) return { text: "Good", color: "var(--good)", rank: 3 };
        if (score < 96) return { text: "Strong", color: "var(--strong)", rank: 4 };
        return { text: "Ultra Strong", color: "var(--xstrong)", rank: 5 };
      }

      function analyze(pw) {
        const zx = typeof zxcvbn === "function" ? zxcvbn(pw) : null;
        const ruleResults = ruleSpecs.map((rule) => ({
          id: rule.id,
          label: rule.label,
          weight: rule.weight,
          ok: !!rule.test(pw)
        }));

        const totalWeight = ruleResults.reduce((sum, r) => sum + r.weight, 0);
        const gained = ruleResults.reduce((sum, r) => sum + (r.ok ? r.weight : 0), 0);
        const ruleScore = totalWeight ? (gained / totalWeight) * 100 : 0;
        const zxScore = zx ? (zx.score / 4) * 100 : 0;

        let finalScore = Math.round(ruleScore * 0.72 + zxScore * 0.28);
        if (!pw.length) finalScore = 0;

        const bits = entropyBits(pw);
        const combos = safeBigIntPow(charsetSize(pw), pw.length);
        const onlineSeconds = combos > 0n ? combos / 10n : 0n;
        const offlineSeconds = combos > 0n ? combos / 10_000_000_000n : 0n;

        const failTop = ruleResults.filter((r) => !r.ok).slice(0, 3).map((r) => r.label);
        let feedback = failTop.length ? `개선 우선순위: ${failTop.join(", ")}` : "모든 규칙 충족. 매우 강한 후보입니다.";
        if (zx && zx.feedback && zx.feedback.warning) feedback = zx.feedback.warning;

        return {
          score: Math.max(0, Math.min(100, finalScore)),
          level: getLevel(finalScore),
          rules: ruleResults,
          bits,
          combos,
          onlineSeconds,
          offlineSeconds,
          feedback
        };
      }

      function paintRules(ruleResults) {
        checklistEl.innerHTML = "";
        let streak = 0;
        for (const r of ruleResults) {
          const li = document.createElement("li");
          li.className = r.ok ? "ok" : "warn";
          li.innerHTML = `<span class="mark">${r.ok ? "✔" : "•"}</span><span>${r.label}</span>`;
          checklistEl.appendChild(li);
          if (r.ok) streak += 1;
        }
        combo = streak;
        comboBadge.textContent = `Security Combo x${combo}`;
      }

      function quake(power) {
        gsap.fromTo(mainCard,
          { x: (Math.random() - 0.5) * power, y: (Math.random() - 0.5) * power, rotate: (Math.random() - 0.5) * 0.7 },
          { x: 0, y: 0, rotate: 0, duration: 0.24, ease: "elastic.out(1.1, 0.45)" }
        );
      }

      function typingBurst() {
        const rect = input.getBoundingClientRect();
        const x = (rect.left + rect.width * 0.7) / window.innerWidth;
        const y = (rect.top + rect.height * 0.45) / window.innerHeight;
        confettiFx({
          particleCount: 8,
          spread: 30,
          startVelocity: 20,
          ticks: 45,
          gravity: 1.4,
          scalar: 0.55,
          origin: { x, y },
          colors: ["#2b8cff", "#7c3aed", "#0f9f6d", "#f59e0b"]
        });
      }

      function celebrate(levelRank, scoreUp) {
        mainCard.classList.add("power");
        setTimeout(() => mainCard.classList.remove("power"), 460);

        if (scoreUp >= 4) {
          confettiFx({ particleCount: 45, spread: 84, origin: { x: 0.18, y: 0.28 } });
          confettiFx({ particleCount: 45, spread: 84, origin: { x: 0.82, y: 0.28 } });
        }
        if (levelRank >= 4) {
          confettiFx({ particleCount: 120, spread: 120, startVelocity: 40, gravity: 0.9, origin: { x: 0.5, y: 0.35 } });
        }

        gsap.fromTo(scoreText, { scale: 1 }, { scale: 1.12, duration: 0.14, yoyo: true, repeat: 1, ease: "power2.out" });
        gsap.fromTo(levelText, { scale: 1 }, { scale: 1.12, duration: 0.14, yoyo: true, repeat: 1, ease: "power2.out" });
      }

      function render() {
        const pw = input.value;
        const data = analyze(pw);

        meterBar.style.width = `${data.score}%`;
        meterBar.style.backgroundColor = data.level.color;

        scoreText.textContent = `${data.score} / 100`;
        levelText.textContent = data.level.text;
        levelText.style.color = data.level.color;

        paintRules(data.rules);

        tips.textContent = data.feedback || "";

        metaInfo.innerHTML = `
          <div>길이: ${pw.length}자</div>
          <div>엔트로피: ${data.bits ? data.bits.toFixed(1) : "0.0"} bit</div>
          <div>예상 조합 수: ${formatBigInt(data.combos)}</div>
          <div>온라인 공격 추정(10/s): ${data.combos > 0n ? humanSeconds(data.onlineSeconds / 2n) : "-"}</div>
          <div>오프라인 공격 추정(10^10/s): ${data.combos > 0n ? humanSeconds(data.offlineSeconds / 2n) : "-"}</div>
        `;

        if (pw.length) {
          input.classList.add("powering");
        } else {
          input.classList.remove("powering");
        }

        const scoreUp = data.score - prevScore;
        if (scoreUp > 0) {
          celebrate(data.level.rank, scoreUp);
        }
        if (data.level.rank > prevLevelRank) {
          confettiFx({ particleCount: 65, spread: 92, origin: { x: 0.5, y: 0.24 } });
        }

        prevScore = data.score;
        prevLevelRank = data.level.rank;
      }

      btnToggle.addEventListener("click", function () {
        const isPw = input.type === "password";
        input.type = isPw ? "text" : "password";
        btnToggle.textContent = isPw ? "Hide" : "Show";
      });

      input.addEventListener("input", function () {
        typingBurst();
        quake(9);
        render();
      });

      input.addEventListener("keydown", function () {
        gsap.fromTo(input, { x: -1.5 }, { x: 1.5, duration: 0.05, yoyo: true, repeat: 1, clearProps: "x" });
      });

      render();
    })();
  </script>
</body>
</html>
